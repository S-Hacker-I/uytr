"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.existsAsync = exports.downloadFile = exports.downloadJson = void 0;
const tslib_1 = require("tslib");
const fs_1 = (0, tslib_1.__importDefault)(require("fs"));
const node_fetch_1 = (0, tslib_1.__importDefault)(require("node-fetch"));
const path_1 = (0, tslib_1.__importDefault)(require("path"));
async function downloadJson(url) {
    const response = await wrappedFetch(url);
    return response.json();
}
exports.downloadJson = downloadJson;
async function downloadFile(url, pathPrefix) {
    const response = await wrappedFetch(url);
    const buffer = await response.buffer();
    const filename = path_1.default.join(pathPrefix, extractFilename(url));
    await fs_1.default.promises.writeFile(filename, buffer);
    return filename;
}
exports.downloadFile = downloadFile;
function existsAsync(file) {
    return new Promise((resolve) => {
        fs_1.default.access(file, (err) => resolve(!err));
    });
}
exports.existsAsync = existsAsync;
async function wrappedFetch(url) {
    const response = await (0, node_fetch_1.default)(url);
    if (!response.ok) {
        throw new Error(`Request failed, status code: ${response.status}`);
    }
    return response;
}
function extractFilename(text) {
    const result = /[^/]*$/.exec(text);
    return result ? result[0] : text;
}
//# sourceMappingURL=utilities.js.map